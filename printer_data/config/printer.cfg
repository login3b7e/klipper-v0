[include mainsail.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_rp2040_454741505A82A88A-if00
## serial: /dev/ttyAMA0 											# for UART connection
restart_method: command

[virtual_sdcard]
path: /home/maarten/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[printer]
kinematics: corexy
max_velocity: 400
max_accel: 10000
max_z_velocity: 25
max_z_accel: 300
square_corner_velocity: 5.0

#####################################################################
#      X/Y Stepper Settings
#####################################################################

[stepper_x] #B motor (Left side)
step_pin: gpio11
dir_pin: gpio10                                                     # Check motor direction in link above. If inverted, add a ! before gpio10
enable_pin: !gpio12
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 200                                        # Set to 400 for 0.9째 degree stepper motor, 200 is for 1.8째 stepper motors
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_endstop: 120
position_max: 120
homing_speed: 60                                                    # for sensorless homing it is recommended not to go above 40mm/s   
homing_retract_dist: 0
homing_positive_dir: true

[tmc2209 stepper_x]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 0
interpolate: False
stealthchop_threshold: 0     
run_current: 0.969
sense_resistor: 0.110
diag_pin: ^gpio4    												# YOU NEED TO JUMP THIS DIAG PIN ON YOUR BOARD FOR SENSORLESS HOMING TO WORK 
driver_SGTHRS: 120
driver_TBL: 1
driver_TOFF: 3
driver_HSTRT: 0
driver_HEND: 2

[stepper_y] #A motor (Right side)
step_pin: gpio6
dir_pin: gpio5                                                      # Check motor direction in link above. If inverted, add a ! before gpio5
enable_pin: !gpio7
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 200                                        # Set to 400 for 0.9째 degree stepper motor, 200 is for 1.8째 stepper motors
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_endstop: 120
position_max: 120
homing_speed: 60                                                    # for sensorless homing it is recommended not to go above 40mm/s   
homing_retract_dist: 0
homing_positive_dir: true

[tmc2209 stepper_y]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 2
interpolate: False
stealthchop_threshold: 0   
run_current: 0.969
sense_resistor: 0.110
diag_pin: ^gpio3
driver_SGTHRS: 125
driver_TBL: 1
driver_TOFF: 3
driver_HSTRT: 0
driver_HEND: 2

[stepper_z]
step_pin: gpio19
dir_pin: !gpio28                                                    # Remove the ! before gpio28 if motor direction is inverted.
enable_pin: !gpio2
rotation_distance: 8                                                # For T8x8 integrated lead screw
microsteps: 32
endstop_pin: ^gpio25
position_endstop: 120
position_max: 120
position_min: -1.5
homing_speed: 25
second_homing_speed: 5.0
homing_retract_dist: 2.0

[tmc2209 stepper_z]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 1
interpolate: True
stealthchop_threshold: 999999   
run_current: 0.7
sense_resistor: 0.110
driver_TBL: 1
driver_TOFF: 3
driver_HSTRT: 0
driver_HEND: 2

#####################################################################
#   Bed Heater
#####################################################################

[heater_bed]
heater_pin: gpio21
sensor_type: Generic 3950
sensor_pin: gpio26
#smooth_time: 3.0
max_power: 1.0
min_temp: 0
max_temp: 120
control: pid                                                        # Do PID calibration after initial checks
pid_kp: 68.453
pid_ki: 2.749
pid_kd: 426.122

#####################################################################
#   Bed Stuff
#####################################################################

[bed_mesh]
algorithm: bicubic
speed: 250
horizontal_move_z: 5
mesh_min: 15, 10
mesh_max: 105, 100
probe_count: 30, 30

## To be used with BED_SCREWS_ADJUST
[bed_screws]
screw1: 3.5, 116.5
screw1_name: front screw
screw2: 116.5,116.5
screw2_name: back left
screw3: 60, 3.5
screw3_name: back right

#####################################################################
#   Other Stuff
#####################################################################

[exclude_object]

[force_move]
enable_force_move: True

[idle_timeout]
timeout: 1800
gcode:
  M84

[include variables.cfg]
[include macros/*/*.cfg]
[include hardware/*.cfg]